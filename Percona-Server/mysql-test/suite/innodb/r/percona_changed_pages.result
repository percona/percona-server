SELECT @@innodb_track_changed_pages;
@@innodb_track_changed_pages
1
SET @OLD_INNODB_CHANGED_PAGES_LIMIT = @@GLOBAL.INNODB_CHANGED_PAGES_LIMIT;
SET GLOBAL INNODB_CHANGED_PAGES_LIMIT = 0;
CREATE TABLE T1 (F1 CHAR(255)) ENGINE=INNODB;
SET @t1_space_id =
(SELECT SPACE
FROM INFORMATION_SCHEMA.INNODB_SYS_TABLES
WHERE
INFORMATION_SCHEMA.INNODB_SYS_TABLES.SCHEMA='test' AND
INFORMATION_SCHEMA.INNODB_SYS_TABLES.NAME='T1');
SET GLOBAL INNODB_CHANGED_PAGES_LIMIT = 0;
SELECT COUNT(DISTINCT PAGE_ID) >= (1024000/16384)
FROM INFORMATION_SCHEMA.INNODB_CHANGED_PAGES
WHERE SPACE_ID = @t1_space_id;
COUNT(DISTINCT PAGE_ID) >= (1024000/16384)
1
SELECT MAX(PAGE_ID) < (3*5*1024000/16384)
FROM INFORMATION_SCHEMA.INNODB_CHANGED_PAGES
WHERE SPACE_ID = @t1_space_id;
MAX(PAGE_ID) < (3*5*1024000/16384)
1
SELECT COUNT(*)
FROM INFORMATION_SCHEMA.INNODB_CHANGED_PAGES
WHERE START_LSN >= END_LSN;
COUNT(*)
0
SELECT COUNT(*) = @cond_test_pages_count
FROM INFORMATION_SCHEMA.INNODB_CHANGED_PAGES
WHERE
END_LSN > (@cond_test_lsn - 1) AND
END_LSN < (@cond_test_lsn + 1);
COUNT(*) = @cond_test_pages_count
1
SET GLOBAL INNODB_CHANGED_PAGES_LIMIT = 1;
SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_CHANGED_PAGES;
COUNT(*)
1
SET GLOBAL INNODB_CHANGED_PAGES_LIMIT = @OLD_INNODB_CHANGED_PAGES_LIMIT;
DROP TABLE T1;
