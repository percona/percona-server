#
# Bug #784464: Silent conversion from Dynamic to Fixed row_format for certain
# values of key_block_size.
# Also see percona_heap_bug784464_32bit and percona_heap_bug784464_64bit tests.
#

CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(32), f3 VARCHAR(32), f4 VARCHAR(32),
              	PRIMARY KEY (f1)) ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 6 X 8 X 12 X 13 X
SHOW TABLE STATUS LIKE 't1';
DROP TABLE t1;

--error ER_CANT_USE_OPTION_HERE
CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(32), f3 VARCHAR(32), f4 VARCHAR(32),
              	PRIMARY KEY (f1)) KEY_BLOCK_SIZE=33 ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 12 X 13 X
SHOW TABLE STATUS LIKE 't1';

CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(32), f3 VARCHAR(32), f4 VARCHAR(32),
              	PRIMARY KEY (f1)) KEY_BLOCK_SIZE=34 ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 6 X 8 X 12 X 13 X
SHOW TABLE STATUS LIKE 't1';
DROP TABLE t1;

CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(32), f3 VARCHAR(32), f4 VARCHAR(32),
              	PRIMARY KEY (f1)) KEY_BLOCK_SIZE=123 ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 6 X 8 X 12 X 13 X
SHOW TABLE STATUS LIKE 't1';
DROP TABLE t1;

CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(32), f3 VARCHAR(32), f4 VARCHAR(32),
              	PRIMARY KEY (f1)) KEY_BLOCK_SIZE=1000 ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 6 X 8 X 12 X 13 X
SHOW TABLE STATUS LIKE 't1';
DROP TABLE t1;

CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(96),
              	PRIMARY KEY (f1)) ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 6 X 8 X 12 X 13 X
SHOW TABLE STATUS LIKE 't1';
DROP TABLE t1;

--error ER_CANT_USE_OPTION_HERE
CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(96),
              	PRIMARY KEY (f1)) KEY_BLOCK_SIZE=33 ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 12 X 13 X
SHOW TABLE STATUS LIKE 't1';

CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(96),
              	PRIMARY KEY (f1)) KEY_BLOCK_SIZE=34 ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 6 X 8 X 12 X 13 X
SHOW TABLE STATUS LIKE 't1';
DROP TABLE t1;

CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(96),
              	PRIMARY KEY (f1)) KEY_BLOCK_SIZE=121 ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 6 X 8 X 12 X 13 X
SHOW TABLE STATUS LIKE 't1';
DROP TABLE t1;

CREATE TABLE t1 (f1 VARCHAR(32), f2 VARCHAR(96),
              	PRIMARY KEY (f1)) KEY_BLOCK_SIZE=1000 ENGINE=HEAP ROW_FORMAT=DYNAMIC;
--replace_column 6 X 8 X 12 X 13 X
SHOW TABLE STATUS LIKE 't1';
DROP TABLE t1;

