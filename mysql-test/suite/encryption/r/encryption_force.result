select @@innodb_encrypt_tables;
@@innodb_encrypt_tables
KEYRING_FORCE
set global innodb_encrypt_tables='KEYRING_FORCE';
create table t1 (a int) engine=innodb encryption='KEYRING';
create table t2 (a varchar(255)) engine=innodb;
create table t3 (a int) engine=innodb encryption='N';
ERROR HY000: InnoDB: Only KEYRING encrypted tables (ENCRYPTION='KEYRING') can be created with innodb_encrypt_tables=KEYRING_FORCE.
create table t4 (a int) engine=innodb encryption='KEYRING' partition by hash(a) partitions 2;
create table t5 (a int) engine=innodb encryption='N' partition by hash(a) partitions 2;
ERROR HY000: InnoDB: Only KEYRING encrypted tables (ENCRYPTION='KEYRING') can be created with innodb_encrypt_tables=KEYRING_FORCE.
set global innodb_encrypt_tables='KEYRING_ON';
create table t3 (a int) engine=innodb encryption='N';
set global innodb_encrypt_tables='KEYRING_FORCE';
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=0
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `a` varchar(255) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=0
show create table t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `a` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ENCRYPTION='N'
show create table t4;
Table	Create Table
t4	CREATE TABLE `t4` (
  `a` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=0
/*!50100 PARTITION BY HASH (a)
PARTITIONS 2 */
alter table t1 encryption='N';
ERROR HY000: InnoDB: Only KEYRING encrypted tables (ENCRYPTION='KEYRING') can be created with innodb_encrypt_tables=KEYRING_FORCE.
alter table t2 encryption='KEYRING';
alter table t3 encryption='KEYRING';
alter table t4 encryption='N';
ERROR HY000: InnoDB: Only KEYRING encrypted tables (ENCRYPTION='KEYRING') can be created with innodb_encrypt_tables=KEYRING_FORCE.
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=0
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `a` varchar(255) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=0
show create table t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `a` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1 ENCRYPTION='KEYRING' ENCRYPTION_KEY_ID=0
insert t2 values (repeat('tempsecret', 12));
# restart
drop table t1;
drop table t2;
drop table t3;
drop table t4;
