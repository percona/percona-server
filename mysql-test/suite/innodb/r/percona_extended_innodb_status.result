SET @innodb_show_verbose_locks_save = @@global.innodb_show_verbose_locks;
SET @innodb_show_locks_held_save = @@global.innodb_show_locks_held;
CREATE TABLE t (id INT PRIMARY KEY, value INT NOT NULL DEFAULT 0) ENGINE=InnoDB;
INSERT INTO t(id) VALUES (0),(1),(2),(3),(4),(5),(6),(7),(8),(9);
SET GLOBAL innodb_show_verbose_locks = 0;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection con1
SET innodb_lock_wait_timeout = 1073741824;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection default
"Record lock" not found
ROLLBACK;
connection con1
ROLLBACK;
connection default
SET GLOBAL innodb_show_verbose_locks = 1;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection con1
SET innodb_lock_wait_timeout = 1073741824;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection default
"Record lock" found
n = 4
ROLLBACK;
connection con1
ROLLBACK;
connection default
CREATE TABLE innodb_lock_monitor (a INT) ENGINE=InnoDB;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection con1
SET innodb_lock_wait_timeout = 1073741824;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection default
"Record lock" found
n = 12
ROLLBACK;
connection con1
ROLLBACK;
connection default
SET GLOBAL innodb_show_locks_held = 1;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection con1
SET innodb_lock_wait_timeout = 1073741824;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection default
"Record lock" found
n = 4
too many locks printed
ROLLBACK;
connection con1
ROLLBACK;
connection default
SET GLOBAL innodb_show_locks_held = 0;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection con1
SET innodb_lock_wait_timeout = 1073741824;
START TRANSACTION;
UPDATE t SET value = 1 WHERE id = 3;
connection default
"Record lock" found
n = 4
ROLLBACK;
connection con1
ROLLBACK;
connection default
SET GLOBAL innodb_show_verbose_locks = @innodb_show_verbose_locks_save;
SET GLOBAL innodb_show_locks_held = @innodb_show_locks_held_save;
DROP TABLE innodb_lock_monitor, t;
#
# Bug 1586262: "Buffer pool size, bytes" always 0 in InnoDB status
#
mysql -e "SHOW ENGINE INNODB STATUS"
Grepping InnoDB status for Buffer pool size, bytes 33538048
