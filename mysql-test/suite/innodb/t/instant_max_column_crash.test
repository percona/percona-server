--source include/have_debug.inc
--echo #
--echo # Bug: #34378513 : Assertion failure: dict0mem.h:2482:pos < n_def thread 140243300361984
--echo #

--echo # Create table with 1017 columns
CREATE TABLE tb1 (
col_1 INT DEFAULT NULL,
col_2 INT DEFAULT NULL,
col_3 INT DEFAULT NULL,
col_4 INT DEFAULT NULL,
col_5 INT DEFAULT NULL,
col_6 INT DEFAULT NULL,
col_7 INT DEFAULT NULL,
col_8 INT DEFAULT NULL,
col_9 INT DEFAULT NULL,
col_10 INT DEFAULT NULL,
col_11 INT DEFAULT NULL,
col_12 INT DEFAULT NULL,
col_13 INT DEFAULT NULL,
col_14 INT DEFAULT NULL,
col_15 INT DEFAULT NULL,
col_16 INT DEFAULT NULL,
col_17 INT DEFAULT NULL,
col_18 INT DEFAULT NULL,
col_19 INT DEFAULT NULL,
col_20 INT DEFAULT NULL,
col_21 INT DEFAULT NULL,
col_22 INT DEFAULT NULL,
col_23 INT DEFAULT NULL,
col_24 INT DEFAULT NULL,
col_25 INT DEFAULT NULL,
col_26 INT DEFAULT NULL,
col_27 INT DEFAULT NULL,
col_28 INT DEFAULT NULL,
col_29 INT DEFAULT NULL,
col_30 INT DEFAULT NULL,
col_31 INT DEFAULT NULL,
col_32 INT DEFAULT NULL,
col_33 INT DEFAULT NULL,
col_34 INT DEFAULT NULL,
col_35 INT DEFAULT NULL,
col_36 INT DEFAULT NULL,
col_37 INT DEFAULT NULL,
col_38 INT DEFAULT NULL,
col_39 INT DEFAULT NULL,
col_40 INT DEFAULT NULL,
col_41 INT DEFAULT NULL,
col_42 INT DEFAULT NULL,
col_43 INT DEFAULT NULL,
col_44 INT DEFAULT NULL,
col_45 INT DEFAULT NULL,
col_46 INT DEFAULT NULL,
col_47 INT DEFAULT NULL,
col_48 INT DEFAULT NULL,
col_49 INT DEFAULT NULL,
col_50 INT DEFAULT NULL,
col_51 INT DEFAULT NULL,
col_52 INT DEFAULT NULL,
col_53 INT DEFAULT NULL,
col_54 INT DEFAULT NULL,
col_55 INT DEFAULT NULL,
col_56 INT DEFAULT NULL,
col_57 INT DEFAULT NULL,
col_58 INT DEFAULT NULL,
col_59 INT DEFAULT NULL,
col_60 INT DEFAULT NULL,
col_61 INT DEFAULT NULL,
col_62 INT DEFAULT NULL,
col_63 INT DEFAULT NULL,
col_64 INT DEFAULT NULL,
col_65 INT DEFAULT NULL,
col_66 INT DEFAULT NULL,
col_67 INT DEFAULT NULL,
col_68 INT DEFAULT NULL,
col_69 INT DEFAULT NULL,
col_70 INT DEFAULT NULL,
col_71 INT DEFAULT NULL,
col_72 INT DEFAULT NULL,
col_73 INT DEFAULT NULL,
col_74 INT DEFAULT NULL,
col_75 INT DEFAULT NULL,
col_76 INT DEFAULT NULL,
col_77 INT DEFAULT NULL,
col_78 INT DEFAULT NULL,
col_79 INT DEFAULT NULL,
col_80 INT DEFAULT NULL,
col_81 INT DEFAULT NULL,
col_82 INT DEFAULT NULL,
col_83 INT DEFAULT NULL,
col_84 INT DEFAULT NULL,
col_85 INT DEFAULT NULL,
col_86 INT DEFAULT NULL,
col_87 INT DEFAULT NULL,
col_88 INT DEFAULT NULL,
col_89 INT DEFAULT NULL,
col_90 INT DEFAULT NULL,
col_91 INT DEFAULT NULL,
col_92 INT DEFAULT NULL,
col_93 INT DEFAULT NULL,
col_94 INT DEFAULT NULL,
col_95 INT DEFAULT NULL,
col_96 INT DEFAULT NULL,
col_97 INT DEFAULT NULL,
col_98 INT DEFAULT NULL,
col_99 INT DEFAULT NULL,
col_100 INT DEFAULT NULL,
col_101 INT DEFAULT NULL,
col_102 INT DEFAULT NULL,
col_103 INT DEFAULT NULL,
col_104 INT DEFAULT NULL,
col_105 INT DEFAULT NULL,
col_106 INT DEFAULT NULL,
col_107 INT DEFAULT NULL,
col_108 INT DEFAULT NULL,
col_109 INT DEFAULT NULL,
col_110 INT DEFAULT NULL,
col_111 INT DEFAULT NULL,
col_112 INT DEFAULT NULL,
col_113 INT DEFAULT NULL,
col_114 INT DEFAULT NULL,
col_115 INT DEFAULT NULL,
col_116 INT DEFAULT NULL,
col_117 INT DEFAULT NULL,
col_118 INT DEFAULT NULL,
col_119 INT DEFAULT NULL,
col_120 INT DEFAULT NULL,
col_121 INT DEFAULT NULL,
col_122 INT DEFAULT NULL,
col_123 INT DEFAULT NULL,
col_124 INT DEFAULT NULL,
col_125 INT DEFAULT NULL,
col_126 INT DEFAULT NULL,
col_127 INT DEFAULT NULL,
col_128 INT DEFAULT NULL,
col_129 INT DEFAULT NULL,
col_130 INT DEFAULT NULL,
col_131 INT DEFAULT NULL,
col_132 INT DEFAULT NULL,
col_133 INT DEFAULT NULL,
col_134 INT DEFAULT NULL,
col_135 INT DEFAULT NULL,
col_136 INT DEFAULT NULL,
col_137 INT DEFAULT NULL,
col_138 INT DEFAULT NULL,
col_139 INT DEFAULT NULL,
col_140 INT DEFAULT NULL,
col_141 INT DEFAULT NULL,
col_142 INT DEFAULT NULL,
col_143 INT DEFAULT NULL,
col_144 INT DEFAULT NULL,
col_145 INT DEFAULT NULL,
col_146 INT DEFAULT NULL,
col_147 INT DEFAULT NULL,
col_148 INT DEFAULT NULL,
col_149 INT DEFAULT NULL,
col_150 INT DEFAULT NULL,
col_151 INT DEFAULT NULL,
col_152 INT DEFAULT NULL,
col_153 INT DEFAULT NULL,
col_154 INT DEFAULT NULL,
col_155 INT DEFAULT NULL,
col_156 INT DEFAULT NULL,
col_157 INT DEFAULT NULL,
col_158 INT DEFAULT NULL,
col_159 INT DEFAULT NULL,
col_160 INT DEFAULT NULL,
col_161 INT DEFAULT NULL,
col_162 INT DEFAULT NULL,
col_163 INT DEFAULT NULL,
col_164 INT DEFAULT NULL,
col_165 INT DEFAULT NULL,
col_166 INT DEFAULT NULL,
col_167 INT DEFAULT NULL,
col_168 INT DEFAULT NULL,
col_169 INT DEFAULT NULL,
col_170 INT DEFAULT NULL,
col_171 INT DEFAULT NULL,
col_172 INT DEFAULT NULL,
col_173 INT DEFAULT NULL,
col_174 INT DEFAULT NULL,
col_175 INT DEFAULT NULL,
col_176 INT DEFAULT NULL,
col_177 INT DEFAULT NULL,
col_178 INT DEFAULT NULL,
col_179 INT DEFAULT NULL,
col_180 INT DEFAULT NULL,
col_181 INT DEFAULT NULL,
col_182 INT DEFAULT NULL,
col_183 INT DEFAULT NULL,
col_184 INT DEFAULT NULL,
col_185 INT DEFAULT NULL,
col_186 INT DEFAULT NULL,
col_187 INT DEFAULT NULL,
col_188 INT DEFAULT NULL,
col_189 INT DEFAULT NULL,
col_190 INT DEFAULT NULL,
col_191 INT DEFAULT NULL,
col_192 INT DEFAULT NULL,
col_193 INT DEFAULT NULL,
col_194 INT DEFAULT NULL,
col_195 INT DEFAULT NULL,
col_196 INT DEFAULT NULL,
col_197 INT DEFAULT NULL,
col_198 INT DEFAULT NULL,
col_199 INT DEFAULT NULL,
col_200 INT DEFAULT NULL,
col_201 INT DEFAULT NULL,
col_202 INT DEFAULT NULL,
col_203 INT DEFAULT NULL,
col_204 INT DEFAULT NULL,
col_205 INT DEFAULT NULL,
col_206 INT DEFAULT NULL,
col_207 INT DEFAULT NULL,
col_208 INT DEFAULT NULL,
col_209 INT DEFAULT NULL,
col_210 INT DEFAULT NULL,
col_211 INT DEFAULT NULL,
col_212 INT DEFAULT NULL,
col_213 INT DEFAULT NULL,
col_214 INT DEFAULT NULL,
col_215 INT DEFAULT NULL,
col_216 INT DEFAULT NULL,
col_217 INT DEFAULT NULL,
col_218 INT DEFAULT NULL,
col_219 INT DEFAULT NULL,
col_220 INT DEFAULT NULL,
col_221 INT DEFAULT NULL,
col_222 INT DEFAULT NULL,
col_223 INT DEFAULT NULL,
col_224 INT DEFAULT NULL,
col_225 INT DEFAULT NULL,
col_226 INT DEFAULT NULL,
col_227 INT DEFAULT NULL,
col_228 INT DEFAULT NULL,
col_229 INT DEFAULT NULL,
col_230 INT DEFAULT NULL,
col_231 INT DEFAULT NULL,
col_232 INT DEFAULT NULL,
col_233 INT DEFAULT NULL,
col_234 INT DEFAULT NULL,
col_235 INT DEFAULT NULL,
col_236 INT DEFAULT NULL,
col_237 INT DEFAULT NULL,
col_238 INT DEFAULT NULL,
col_239 INT DEFAULT NULL,
col_240 INT DEFAULT NULL,
col_241 INT DEFAULT NULL,
col_242 INT DEFAULT NULL,
col_243 INT DEFAULT NULL,
col_244 INT DEFAULT NULL,
col_245 INT DEFAULT NULL,
col_246 INT DEFAULT NULL,
col_247 INT DEFAULT NULL,
col_248 INT DEFAULT NULL,
col_249 INT DEFAULT NULL,
col_250 INT DEFAULT NULL,
col_251 INT DEFAULT NULL,
col_252 INT DEFAULT NULL,
col_253 INT DEFAULT NULL,
col_254 INT DEFAULT NULL,
col_255 INT DEFAULT NULL,
col_256 INT DEFAULT NULL,
col_257 INT DEFAULT NULL,
col_258 INT DEFAULT NULL,
col_259 INT DEFAULT NULL,
col_260 INT DEFAULT NULL,
col_261 INT DEFAULT NULL,
col_262 INT DEFAULT NULL,
col_263 INT DEFAULT NULL,
col_264 INT DEFAULT NULL,
col_265 INT DEFAULT NULL,
col_266 INT DEFAULT NULL,
col_267 INT DEFAULT NULL,
col_268 INT DEFAULT NULL,
col_269 INT DEFAULT NULL,
col_270 INT DEFAULT NULL,
col_271 INT DEFAULT NULL,
col_272 INT DEFAULT NULL,
col_273 INT DEFAULT NULL,
col_274 INT DEFAULT NULL,
col_275 INT DEFAULT NULL,
col_276 INT DEFAULT NULL,
col_277 INT DEFAULT NULL,
col_278 INT DEFAULT NULL,
col_279 INT DEFAULT NULL,
col_280 INT DEFAULT NULL,
col_281 INT DEFAULT NULL,
col_282 INT DEFAULT NULL,
col_283 INT DEFAULT NULL,
col_284 INT DEFAULT NULL,
col_285 INT DEFAULT NULL,
col_286 INT DEFAULT NULL,
col_287 INT DEFAULT NULL,
col_288 INT DEFAULT NULL,
col_289 INT DEFAULT NULL,
col_290 INT DEFAULT NULL,
col_291 INT DEFAULT NULL,
col_292 INT DEFAULT NULL,
col_293 INT DEFAULT NULL,
col_294 INT DEFAULT NULL,
col_295 INT DEFAULT NULL,
col_296 INT DEFAULT NULL,
col_297 INT DEFAULT NULL,
col_298 INT DEFAULT NULL,
col_299 INT DEFAULT NULL,
col_300 INT DEFAULT NULL,
col_301 INT DEFAULT NULL,
col_302 INT DEFAULT NULL,
col_303 INT DEFAULT NULL,
col_304 INT DEFAULT NULL,
col_305 INT DEFAULT NULL,
col_306 INT DEFAULT NULL,
col_307 INT DEFAULT NULL,
col_308 INT DEFAULT NULL,
col_309 INT DEFAULT NULL,
col_310 INT DEFAULT NULL,
col_311 INT DEFAULT NULL,
col_312 INT DEFAULT NULL,
col_313 INT DEFAULT NULL,
col_314 INT DEFAULT NULL,
col_315 INT DEFAULT NULL,
col_316 INT DEFAULT NULL,
col_317 INT DEFAULT NULL,
col_318 INT DEFAULT NULL,
col_319 INT DEFAULT NULL,
col_320 INT DEFAULT NULL,
col_321 INT DEFAULT NULL,
col_322 INT DEFAULT NULL,
col_323 INT DEFAULT NULL,
col_324 INT DEFAULT NULL,
col_325 INT DEFAULT NULL,
col_326 INT DEFAULT NULL,
col_327 INT DEFAULT NULL,
col_328 INT DEFAULT NULL,
col_329 INT DEFAULT NULL,
col_330 INT DEFAULT NULL,
col_331 INT DEFAULT NULL,
col_332 INT DEFAULT NULL,
col_333 INT DEFAULT NULL,
col_334 INT DEFAULT NULL,
col_335 INT DEFAULT NULL,
col_336 INT DEFAULT NULL,
col_337 INT DEFAULT NULL,
col_338 INT DEFAULT NULL,
col_339 INT DEFAULT NULL,
col_340 INT DEFAULT NULL,
col_341 INT DEFAULT NULL,
col_342 INT DEFAULT NULL,
col_343 INT DEFAULT NULL,
col_344 INT DEFAULT NULL,
col_345 INT DEFAULT NULL,
col_346 INT DEFAULT NULL,
col_347 INT DEFAULT NULL,
col_348 INT DEFAULT NULL,
col_349 INT DEFAULT NULL,
col_350 INT DEFAULT NULL,
col_351 INT DEFAULT NULL,
col_352 INT DEFAULT NULL,
col_353 INT DEFAULT NULL,
col_354 INT DEFAULT NULL,
col_355 INT DEFAULT NULL,
col_356 INT DEFAULT NULL,
col_357 INT DEFAULT NULL,
col_358 INT DEFAULT NULL,
col_359 INT DEFAULT NULL,
col_360 INT DEFAULT NULL,
col_361 INT DEFAULT NULL,
col_362 INT DEFAULT NULL,
col_363 INT DEFAULT NULL,
col_364 INT DEFAULT NULL,
col_365 INT DEFAULT NULL,
col_366 INT DEFAULT NULL,
col_367 INT DEFAULT NULL,
col_368 INT DEFAULT NULL,
col_369 INT DEFAULT NULL,
col_370 INT DEFAULT NULL,
col_371 INT DEFAULT NULL,
col_372 INT DEFAULT NULL,
col_373 INT DEFAULT NULL,
col_374 INT DEFAULT NULL,
col_375 INT DEFAULT NULL,
col_376 INT DEFAULT NULL,
col_377 INT DEFAULT NULL,
col_378 INT DEFAULT NULL,
col_379 INT DEFAULT NULL,
col_380 INT DEFAULT NULL,
col_381 INT DEFAULT NULL,
col_382 INT DEFAULT NULL,
col_383 INT DEFAULT NULL,
col_384 INT DEFAULT NULL,
col_385 INT DEFAULT NULL,
col_386 INT DEFAULT NULL,
col_387 INT DEFAULT NULL,
col_388 INT DEFAULT NULL,
col_389 INT DEFAULT NULL,
col_390 INT DEFAULT NULL,
col_391 INT DEFAULT NULL,
col_392 INT DEFAULT NULL,
col_393 INT DEFAULT NULL,
col_394 INT DEFAULT NULL,
col_395 INT DEFAULT NULL,
col_396 INT DEFAULT NULL,
col_397 INT DEFAULT NULL,
col_398 INT DEFAULT NULL,
col_399 INT DEFAULT NULL,
col_400 INT DEFAULT NULL,
col_401 INT DEFAULT NULL,
col_402 INT DEFAULT NULL,
col_403 INT DEFAULT NULL,
col_404 INT DEFAULT NULL,
col_405 INT DEFAULT NULL,
col_406 INT DEFAULT NULL,
col_407 INT DEFAULT NULL,
col_408 INT DEFAULT NULL,
col_409 INT DEFAULT NULL,
col_410 INT DEFAULT NULL,
col_411 INT DEFAULT NULL,
col_412 INT DEFAULT NULL,
col_413 INT DEFAULT NULL,
col_414 INT DEFAULT NULL,
col_415 INT DEFAULT NULL,
col_416 INT DEFAULT NULL,
col_417 INT DEFAULT NULL,
col_418 INT DEFAULT NULL,
col_419 INT DEFAULT NULL,
col_420 INT DEFAULT NULL,
col_421 INT DEFAULT NULL,
col_422 INT DEFAULT NULL,
col_423 INT DEFAULT NULL,
col_424 INT DEFAULT NULL,
col_425 INT DEFAULT NULL,
col_426 INT DEFAULT NULL,
col_427 INT DEFAULT NULL,
col_428 INT DEFAULT NULL,
col_429 INT DEFAULT NULL,
col_430 INT DEFAULT NULL,
col_431 INT DEFAULT NULL,
col_432 INT DEFAULT NULL,
col_433 INT DEFAULT NULL,
col_434 INT DEFAULT NULL,
col_435 INT DEFAULT NULL,
col_436 INT DEFAULT NULL,
col_437 INT DEFAULT NULL,
col_438 INT DEFAULT NULL,
col_439 INT DEFAULT NULL,
col_440 INT DEFAULT NULL,
col_441 INT DEFAULT NULL,
col_442 INT DEFAULT NULL,
col_443 INT DEFAULT NULL,
col_444 INT DEFAULT NULL,
col_445 INT DEFAULT NULL,
col_446 INT DEFAULT NULL,
col_447 INT DEFAULT NULL,
col_448 INT DEFAULT NULL,
col_449 INT DEFAULT NULL,
col_450 INT DEFAULT NULL,
col_451 INT DEFAULT NULL,
col_452 INT DEFAULT NULL,
col_453 INT DEFAULT NULL,
col_454 INT DEFAULT NULL,
col_455 INT DEFAULT NULL,
col_456 INT DEFAULT NULL,
col_457 INT DEFAULT NULL,
col_458 INT DEFAULT NULL,
col_459 INT DEFAULT NULL,
col_460 INT DEFAULT NULL,
col_461 INT DEFAULT NULL,
col_462 INT DEFAULT NULL,
col_463 INT DEFAULT NULL,
col_464 INT DEFAULT NULL,
col_465 INT DEFAULT NULL,
col_466 INT DEFAULT NULL,
col_467 INT DEFAULT NULL,
col_468 INT DEFAULT NULL,
col_469 INT DEFAULT NULL,
col_470 INT DEFAULT NULL,
col_471 INT DEFAULT NULL,
col_472 INT DEFAULT NULL,
col_473 INT DEFAULT NULL,
col_474 INT DEFAULT NULL,
col_475 INT DEFAULT NULL,
col_476 INT DEFAULT NULL,
col_477 INT DEFAULT NULL,
col_478 INT DEFAULT NULL,
col_479 INT DEFAULT NULL,
col_480 INT DEFAULT NULL,
col_481 INT DEFAULT NULL,
col_482 INT DEFAULT NULL,
col_483 INT DEFAULT NULL,
col_484 INT DEFAULT NULL,
col_485 INT DEFAULT NULL,
col_486 INT DEFAULT NULL,
col_487 INT DEFAULT NULL,
col_488 INT DEFAULT NULL,
col_489 INT DEFAULT NULL,
col_490 INT DEFAULT NULL,
col_491 INT DEFAULT NULL,
col_492 INT DEFAULT NULL,
col_493 INT DEFAULT NULL,
col_494 INT DEFAULT NULL,
col_495 INT DEFAULT NULL,
col_496 INT DEFAULT NULL,
col_497 INT DEFAULT NULL,
col_498 INT DEFAULT NULL,
col_499 INT DEFAULT NULL,
col_500 INT DEFAULT NULL,
col_501 INT DEFAULT NULL,
col_502 INT DEFAULT NULL,
col_503 INT DEFAULT NULL,
col_504 INT DEFAULT NULL,
col_505 INT DEFAULT NULL,
col_506 INT DEFAULT NULL,
col_507 INT DEFAULT NULL,
col_508 INT DEFAULT NULL,
col_509 INT DEFAULT NULL,
col_510 INT DEFAULT NULL,
col_511 INT DEFAULT NULL,
col_512 INT DEFAULT NULL,
col_513 INT DEFAULT NULL,
col_514 INT DEFAULT NULL,
col_515 INT DEFAULT NULL,
col_516 INT DEFAULT NULL,
col_517 INT DEFAULT NULL,
col_518 INT DEFAULT NULL,
col_519 INT DEFAULT NULL,
col_520 INT DEFAULT NULL,
col_521 INT DEFAULT NULL,
col_522 INT DEFAULT NULL,
col_523 INT DEFAULT NULL,
col_524 INT DEFAULT NULL,
col_525 INT DEFAULT NULL,
col_526 INT DEFAULT NULL,
col_527 INT DEFAULT NULL,
col_528 INT DEFAULT NULL,
col_529 INT DEFAULT NULL,
col_530 INT DEFAULT NULL,
col_531 INT DEFAULT NULL,
col_532 INT DEFAULT NULL,
col_533 INT DEFAULT NULL,
col_534 INT DEFAULT NULL,
col_535 INT DEFAULT NULL,
col_536 INT DEFAULT NULL,
col_537 INT DEFAULT NULL,
col_538 INT DEFAULT NULL,
col_539 INT DEFAULT NULL,
col_540 INT DEFAULT NULL,
col_541 INT DEFAULT NULL,
col_542 INT DEFAULT NULL,
col_543 INT DEFAULT NULL,
col_544 INT DEFAULT NULL,
col_545 INT DEFAULT NULL,
col_546 INT DEFAULT NULL,
col_547 INT DEFAULT NULL,
col_548 INT DEFAULT NULL,
col_549 INT DEFAULT NULL,
col_550 INT DEFAULT NULL,
col_551 INT DEFAULT NULL,
col_552 INT DEFAULT NULL,
col_553 INT DEFAULT NULL,
col_554 INT DEFAULT NULL,
col_555 INT DEFAULT NULL,
col_556 INT DEFAULT NULL,
col_557 INT DEFAULT NULL,
col_558 INT DEFAULT NULL,
col_559 INT DEFAULT NULL,
col_560 INT DEFAULT NULL,
col_561 INT DEFAULT NULL,
col_562 INT DEFAULT NULL,
col_563 INT DEFAULT NULL,
col_564 INT DEFAULT NULL,
col_565 INT DEFAULT NULL,
col_566 INT DEFAULT NULL,
col_567 INT DEFAULT NULL,
col_568 INT DEFAULT NULL,
col_569 INT DEFAULT NULL,
col_570 INT DEFAULT NULL,
col_571 INT DEFAULT NULL,
col_572 INT DEFAULT NULL,
col_573 INT DEFAULT NULL,
col_574 INT DEFAULT NULL,
col_575 INT DEFAULT NULL,
col_576 INT DEFAULT NULL,
col_577 INT DEFAULT NULL,
col_578 INT DEFAULT NULL,
col_579 INT DEFAULT NULL,
col_580 INT DEFAULT NULL,
col_581 INT DEFAULT NULL,
col_582 INT DEFAULT NULL,
col_583 INT DEFAULT NULL,
col_584 INT DEFAULT NULL,
col_585 INT DEFAULT NULL,
col_586 INT DEFAULT NULL,
col_587 INT DEFAULT NULL,
col_588 INT DEFAULT NULL,
col_589 INT DEFAULT NULL,
col_590 INT DEFAULT NULL,
col_591 INT DEFAULT NULL,
col_592 INT DEFAULT NULL,
col_593 INT DEFAULT NULL,
col_594 INT DEFAULT NULL,
col_595 INT DEFAULT NULL,
col_596 INT DEFAULT NULL,
col_597 INT DEFAULT NULL,
col_598 INT DEFAULT NULL,
col_599 INT DEFAULT NULL,
col_600 INT DEFAULT NULL,
col_601 INT DEFAULT NULL,
col_602 INT DEFAULT NULL,
col_603 INT DEFAULT NULL,
col_604 INT DEFAULT NULL,
col_605 INT DEFAULT NULL,
col_606 INT DEFAULT NULL,
col_607 INT DEFAULT NULL,
col_608 INT DEFAULT NULL,
col_609 INT DEFAULT NULL,
col_610 INT DEFAULT NULL,
col_611 INT DEFAULT NULL,
col_612 INT DEFAULT NULL,
col_613 INT DEFAULT NULL,
col_614 INT DEFAULT NULL,
col_615 INT DEFAULT NULL,
col_616 INT DEFAULT NULL,
col_617 INT DEFAULT NULL,
col_618 INT DEFAULT NULL,
col_619 INT DEFAULT NULL,
col_620 INT DEFAULT NULL,
col_621 INT DEFAULT NULL,
col_622 INT DEFAULT NULL,
col_623 INT DEFAULT NULL,
col_624 INT DEFAULT NULL,
col_625 INT DEFAULT NULL,
col_626 INT DEFAULT NULL,
col_627 INT DEFAULT NULL,
col_628 INT DEFAULT NULL,
col_629 INT DEFAULT NULL,
col_630 INT DEFAULT NULL,
col_631 INT DEFAULT NULL,
col_632 INT DEFAULT NULL,
col_633 INT DEFAULT NULL,
col_634 INT DEFAULT NULL,
col_635 INT DEFAULT NULL,
col_636 INT DEFAULT NULL,
col_637 INT DEFAULT NULL,
col_638 INT DEFAULT NULL,
col_639 INT DEFAULT NULL,
col_640 INT DEFAULT NULL,
col_641 INT DEFAULT NULL,
col_642 INT DEFAULT NULL,
col_643 INT DEFAULT NULL,
col_644 INT DEFAULT NULL,
col_645 INT DEFAULT NULL,
col_646 INT DEFAULT NULL,
col_647 INT DEFAULT NULL,
col_648 INT DEFAULT NULL,
col_649 INT DEFAULT NULL,
col_650 INT DEFAULT NULL,
col_651 INT DEFAULT NULL,
col_652 INT DEFAULT NULL,
col_653 INT DEFAULT NULL,
col_654 INT DEFAULT NULL,
col_655 INT DEFAULT NULL,
col_656 INT DEFAULT NULL,
col_657 INT DEFAULT NULL,
col_658 INT DEFAULT NULL,
col_659 INT DEFAULT NULL,
col_660 INT DEFAULT NULL,
col_661 INT DEFAULT NULL,
col_662 INT DEFAULT NULL,
col_663 INT DEFAULT NULL,
col_664 INT DEFAULT NULL,
col_665 INT DEFAULT NULL,
col_666 INT DEFAULT NULL,
col_667 INT DEFAULT NULL,
col_668 INT DEFAULT NULL,
col_669 INT DEFAULT NULL,
col_670 INT DEFAULT NULL,
col_671 INT DEFAULT NULL,
col_672 INT DEFAULT NULL,
col_673 INT DEFAULT NULL,
col_674 INT DEFAULT NULL,
col_675 INT DEFAULT NULL,
col_676 INT DEFAULT NULL,
col_677 INT DEFAULT NULL,
col_678 INT DEFAULT NULL,
col_679 INT DEFAULT NULL,
col_680 INT DEFAULT NULL,
col_681 INT DEFAULT NULL,
col_682 INT DEFAULT NULL,
col_683 INT DEFAULT NULL,
col_684 INT DEFAULT NULL,
col_685 INT DEFAULT NULL,
col_686 INT DEFAULT NULL,
col_687 INT DEFAULT NULL,
col_688 INT DEFAULT NULL,
col_689 INT DEFAULT NULL,
col_690 INT DEFAULT NULL,
col_691 INT DEFAULT NULL,
col_692 INT DEFAULT NULL,
col_693 INT DEFAULT NULL,
col_694 INT DEFAULT NULL,
col_695 INT DEFAULT NULL,
col_696 INT DEFAULT NULL,
col_697 INT DEFAULT NULL,
col_698 INT DEFAULT NULL,
col_699 INT DEFAULT NULL,
col_700 INT DEFAULT NULL,
col_701 INT DEFAULT NULL,
col_702 INT DEFAULT NULL,
col_703 INT DEFAULT NULL,
col_704 INT DEFAULT NULL,
col_705 INT DEFAULT NULL,
col_706 INT DEFAULT NULL,
col_707 INT DEFAULT NULL,
col_708 INT DEFAULT NULL,
col_709 INT DEFAULT NULL,
col_710 INT DEFAULT NULL,
col_711 INT DEFAULT NULL,
col_712 INT DEFAULT NULL,
col_713 INT DEFAULT NULL,
col_714 INT DEFAULT NULL,
col_715 INT DEFAULT NULL,
col_716 INT DEFAULT NULL,
col_717 INT DEFAULT NULL,
col_718 INT DEFAULT NULL,
col_719 INT DEFAULT NULL,
col_720 INT DEFAULT NULL,
col_721 INT DEFAULT NULL,
col_722 INT DEFAULT NULL,
col_723 INT DEFAULT NULL,
col_724 INT DEFAULT NULL,
col_725 INT DEFAULT NULL,
col_726 INT DEFAULT NULL,
col_727 INT DEFAULT NULL,
col_728 INT DEFAULT NULL,
col_729 INT DEFAULT NULL,
col_730 INT DEFAULT NULL,
col_731 INT DEFAULT NULL,
col_732 INT DEFAULT NULL,
col_733 INT DEFAULT NULL,
col_734 INT DEFAULT NULL,
col_735 INT DEFAULT NULL,
col_736 INT DEFAULT NULL,
col_737 INT DEFAULT NULL,
col_738 INT DEFAULT NULL,
col_739 INT DEFAULT NULL,
col_740 INT DEFAULT NULL,
col_741 INT DEFAULT NULL,
col_742 INT DEFAULT NULL,
col_743 INT DEFAULT NULL,
col_744 INT DEFAULT NULL,
col_745 INT DEFAULT NULL,
col_746 INT DEFAULT NULL,
col_747 INT DEFAULT NULL,
col_748 INT DEFAULT NULL,
col_749 INT DEFAULT NULL,
col_750 INT DEFAULT NULL,
col_751 INT DEFAULT NULL,
col_752 INT DEFAULT NULL,
col_753 INT DEFAULT NULL,
col_754 INT DEFAULT NULL,
col_755 INT DEFAULT NULL,
col_756 INT DEFAULT NULL,
col_757 INT DEFAULT NULL,
col_758 INT DEFAULT NULL,
col_759 INT DEFAULT NULL,
col_760 INT DEFAULT NULL,
col_761 INT DEFAULT NULL,
col_762 INT DEFAULT NULL,
col_763 INT DEFAULT NULL,
col_764 INT DEFAULT NULL,
col_765 INT DEFAULT NULL,
col_766 INT DEFAULT NULL,
col_767 INT DEFAULT NULL,
col_768 INT DEFAULT NULL,
col_769 INT DEFAULT NULL,
col_770 INT DEFAULT NULL,
col_771 INT DEFAULT NULL,
col_772 INT DEFAULT NULL,
col_773 INT DEFAULT NULL,
col_774 INT DEFAULT NULL,
col_775 INT DEFAULT NULL,
col_776 INT DEFAULT NULL,
col_777 INT DEFAULT NULL,
col_778 INT DEFAULT NULL,
col_779 INT DEFAULT NULL,
col_780 INT DEFAULT NULL,
col_781 INT DEFAULT NULL,
col_782 INT DEFAULT NULL,
col_783 INT DEFAULT NULL,
col_784 INT DEFAULT NULL,
col_785 INT DEFAULT NULL,
col_786 INT DEFAULT NULL,
col_787 INT DEFAULT NULL,
col_788 INT DEFAULT NULL,
col_789 INT DEFAULT NULL,
col_790 INT DEFAULT NULL,
col_791 INT DEFAULT NULL,
col_792 INT DEFAULT NULL,
col_793 INT DEFAULT NULL,
col_794 INT DEFAULT NULL,
col_795 INT DEFAULT NULL,
col_796 INT DEFAULT NULL,
col_797 INT DEFAULT NULL,
col_798 INT DEFAULT NULL,
col_799 INT DEFAULT NULL,
col_800 INT DEFAULT NULL,
col_801 INT DEFAULT NULL,
col_802 INT DEFAULT NULL,
col_803 INT DEFAULT NULL,
col_804 INT DEFAULT NULL,
col_805 INT DEFAULT NULL,
col_806 INT DEFAULT NULL,
col_807 INT DEFAULT NULL,
col_808 INT DEFAULT NULL,
col_809 INT DEFAULT NULL,
col_810 INT DEFAULT NULL,
col_811 INT DEFAULT NULL,
col_812 INT DEFAULT NULL,
col_813 INT DEFAULT NULL,
col_814 INT DEFAULT NULL,
col_815 INT DEFAULT NULL,
col_816 INT DEFAULT NULL,
col_817 INT DEFAULT NULL,
col_818 INT DEFAULT NULL,
col_819 INT DEFAULT NULL,
col_820 INT DEFAULT NULL,
col_821 INT DEFAULT NULL,
col_822 INT DEFAULT NULL,
col_823 INT DEFAULT NULL,
col_824 INT DEFAULT NULL,
col_825 INT DEFAULT NULL,
col_826 INT DEFAULT NULL,
col_827 INT DEFAULT NULL,
col_828 INT DEFAULT NULL,
col_829 INT DEFAULT NULL,
col_830 INT DEFAULT NULL,
col_831 INT DEFAULT NULL,
col_832 INT DEFAULT NULL,
col_833 INT DEFAULT NULL,
col_834 INT DEFAULT NULL,
col_835 INT DEFAULT NULL,
col_836 INT DEFAULT NULL,
col_837 INT DEFAULT NULL,
col_838 INT DEFAULT NULL,
col_839 INT DEFAULT NULL,
col_840 INT DEFAULT NULL,
col_841 INT DEFAULT NULL,
col_842 INT DEFAULT NULL,
col_843 INT DEFAULT NULL,
col_844 INT DEFAULT NULL,
col_845 INT DEFAULT NULL,
col_846 INT DEFAULT NULL,
col_847 INT DEFAULT NULL,
col_848 INT DEFAULT NULL,
col_849 INT DEFAULT NULL,
col_850 INT DEFAULT NULL,
col_851 INT DEFAULT NULL,
col_852 INT DEFAULT NULL,
col_853 INT DEFAULT NULL,
col_854 INT DEFAULT NULL,
col_855 INT DEFAULT NULL,
col_856 INT DEFAULT NULL,
col_857 INT DEFAULT NULL,
col_858 INT DEFAULT NULL,
col_859 INT DEFAULT NULL,
col_860 INT DEFAULT NULL,
col_861 INT DEFAULT NULL,
col_862 INT DEFAULT NULL,
col_863 INT DEFAULT NULL,
col_864 INT DEFAULT NULL,
col_865 INT DEFAULT NULL,
col_866 INT DEFAULT NULL,
col_867 INT DEFAULT NULL,
col_868 INT DEFAULT NULL,
col_869 INT DEFAULT NULL,
col_870 INT DEFAULT NULL,
col_871 INT DEFAULT NULL,
col_872 INT DEFAULT NULL,
col_873 INT DEFAULT NULL,
col_874 INT DEFAULT NULL,
col_875 INT DEFAULT NULL,
col_876 INT DEFAULT NULL,
col_877 INT DEFAULT NULL,
col_878 INT DEFAULT NULL,
col_879 INT DEFAULT NULL,
col_880 INT DEFAULT NULL,
col_881 INT DEFAULT NULL,
col_882 INT DEFAULT NULL,
col_883 INT DEFAULT NULL,
col_884 INT DEFAULT NULL,
col_885 INT DEFAULT NULL,
col_886 INT DEFAULT NULL,
col_887 INT DEFAULT NULL,
col_888 INT DEFAULT NULL,
col_889 INT DEFAULT NULL,
col_890 INT DEFAULT NULL,
col_891 INT DEFAULT NULL,
col_892 INT DEFAULT NULL,
col_893 INT DEFAULT NULL,
col_894 INT DEFAULT NULL,
col_895 INT DEFAULT NULL,
col_896 INT DEFAULT NULL,
col_897 INT DEFAULT NULL,
col_898 INT DEFAULT NULL,
col_899 INT DEFAULT NULL,
col_900 INT DEFAULT NULL,
col_901 INT DEFAULT NULL,
col_902 INT DEFAULT NULL,
col_903 INT DEFAULT NULL,
col_904 INT DEFAULT NULL,
col_905 INT DEFAULT NULL,
col_906 INT DEFAULT NULL,
col_907 INT DEFAULT NULL,
col_908 INT DEFAULT NULL,
col_909 INT DEFAULT NULL,
col_910 INT DEFAULT NULL,
col_911 INT DEFAULT NULL,
col_912 INT DEFAULT NULL,
col_913 INT DEFAULT NULL,
col_914 INT DEFAULT NULL,
col_915 INT DEFAULT NULL,
col_916 INT DEFAULT NULL,
col_917 INT DEFAULT NULL,
col_918 INT DEFAULT NULL,
col_919 INT DEFAULT NULL,
col_920 INT DEFAULT NULL,
col_921 INT DEFAULT NULL,
col_922 INT DEFAULT NULL,
col_923 INT DEFAULT NULL,
col_924 INT DEFAULT NULL,
col_925 INT DEFAULT NULL,
col_926 INT DEFAULT NULL,
col_927 INT DEFAULT NULL,
col_928 INT DEFAULT NULL,
col_929 INT DEFAULT NULL,
col_930 INT DEFAULT NULL,
col_931 INT DEFAULT NULL,
col_932 INT DEFAULT NULL,
col_933 INT DEFAULT NULL,
col_934 INT DEFAULT NULL,
col_935 INT DEFAULT NULL,
col_936 INT DEFAULT NULL,
col_937 INT DEFAULT NULL,
col_938 INT DEFAULT NULL,
col_939 INT DEFAULT NULL,
col_940 INT DEFAULT NULL,
col_941 INT DEFAULT NULL,
col_942 INT DEFAULT NULL,
col_943 INT DEFAULT NULL,
col_944 INT DEFAULT NULL,
col_945 INT DEFAULT NULL,
col_946 INT DEFAULT NULL,
col_947 INT DEFAULT NULL,
col_948 INT DEFAULT NULL,
col_949 INT DEFAULT NULL,
col_950 INT DEFAULT NULL,
col_951 INT DEFAULT NULL,
col_952 INT DEFAULT NULL,
col_953 INT DEFAULT NULL,
col_954 INT DEFAULT NULL,
col_955 INT DEFAULT NULL,
col_956 INT DEFAULT NULL,
col_957 INT DEFAULT NULL,
col_958 INT DEFAULT NULL,
col_959 INT DEFAULT NULL,
col_960 INT DEFAULT NULL,
col_961 INT DEFAULT NULL,
col_962 INT DEFAULT NULL,
col_963 INT DEFAULT NULL,
col_964 INT DEFAULT NULL,
col_965 INT DEFAULT NULL,
col_966 INT DEFAULT NULL,
col_967 INT DEFAULT NULL,
col_968 INT DEFAULT NULL,
col_969 INT DEFAULT NULL,
col_970 INT DEFAULT NULL,
col_971 INT DEFAULT NULL,
col_972 INT DEFAULT NULL,
col_973 INT DEFAULT NULL,
col_974 INT DEFAULT NULL,
col_975 INT DEFAULT NULL,
col_976 INT DEFAULT NULL,
col_977 INT DEFAULT NULL,
col_978 INT DEFAULT NULL,
col_979 INT DEFAULT NULL,
col_980 INT DEFAULT NULL,
col_981 INT DEFAULT NULL,
col_982 INT DEFAULT NULL,
col_983 INT DEFAULT NULL,
col_984 INT DEFAULT NULL,
col_985 INT DEFAULT NULL,
col_986 INT DEFAULT NULL,
col_987 INT DEFAULT NULL,
col_988 INT DEFAULT NULL,
col_989 INT DEFAULT NULL,
col_990 INT DEFAULT NULL,
col_991 INT DEFAULT NULL,
col_992 INT DEFAULT NULL,
col_993 INT DEFAULT NULL,
col_994 INT DEFAULT NULL,
col_995 INT DEFAULT NULL,
col_996 INT DEFAULT NULL,
col_997 INT DEFAULT NULL,
col_998 INT DEFAULT NULL,
col_999 INT DEFAULT NULL,
col_1000 INT DEFAULT NULL,
col_1001 INT DEFAULT NULL,
col_1002 INT DEFAULT NULL,
col_1003 INT DEFAULT NULL,
col_1004 INT DEFAULT NULL,
col_1005 INT DEFAULT NULL,
col_1006 INT DEFAULT NULL,
col_1007 INT DEFAULT NULL,
col_1008 INT DEFAULT NULL,
col_1009 INT DEFAULT NULL,
col_1010 INT DEFAULT NULL,
col_1011 INT DEFAULT NULL,
col_1012 INT DEFAULT NULL,
col_1013 INT DEFAULT NULL,
col_1014 INT DEFAULT NULL,
col_1015 INT DEFAULT NULL,
col_1016 INT DEFAULT NULL,
col_last INT DEFAULT NULL) ENGINE=InnoDB;

--echo # Generate row version
INSERT INTO tb1 (col_last) VALUES (1);

--echo # Keep a copy for other scenarios
CREATE TABLE t1 AS SELECT * FROM tb1;
CREATE TABLE t2 AS SELECT * FROM tb1;
CREATE TABLE t3 AS SELECT * FROM tb1;
CREATE TABLE t4 AS SELECT * FROM tb1;

--echo ########################################
--echo # Scenario 1: ADD/DROP single column:
--echo ########################################
--echo # REC_MAX_N_FIELDS = 1023 -- max number of fields allowed.
--echo # Step 1. DROP - ADD columns until (n_def + <col_added> < REC_MAX_N_FIELDS)

--echo # Current: n_def = 1020 (<user> + 3(DB_ROW_ID + DB_TRX_ID + DB_ROLL_PTR) + <drop_cols>)
--echo # Current: n_def = 1020 (1017 + 3 + 0)

ALTER TABLE tb1 DROP COLUMN col_last, ALGORITHM=INSTANT;
--echo # Current: n_def = 1020 (1016 + 3 + 1)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/tb1";

ALTER TABLE tb1 ADD COLUMN col_last INT, ALGORITHM=INSTANT;
--echo # Current: n_def = 1021 (1017 + 3 + 1)

ALTER TABLE tb1 DROP COLUMN col_last, ALGORITHM=INSTANT;
--echo # Current: n_def = 1021 (1016 + 3 + 2)

ALTER TABLE tb1 ADD COLUMN col_last INT, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1017 + 3 + 2)

ALTER TABLE tb1 DROP COLUMN col_last, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1016 + 3 + 3)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/tb1";

--echo # Step 2. Test that ADD with ALGORITHM=INSTANT is no longer allowed:
--echo # Current: n_def = 1022 (1016 + 3 + 3)
--echo # If we ADD 1 column: n_def = 1023 (1017 + 3 + 3) becomes REC_MAX_N_FIELDS -- not allowed
--error ER_INNODB_INSTANT_ADD_NOT_SUPPORTED_MAX_FIELDS
ALTER TABLE tb1 ADD COLUMN col_last INT, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1016 + 3 + 3)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/tb1";

--echo # Note that we can still DROP columns with INSTANT:
ALTER TABLE tb1 DROP COLUMN col_1016, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1015 + 3 + 4)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/tb1";

--echo # But we cannot ADD any more columns with INSTANT:
--echo # If we ADD 1 column: n_def = 1023 (1016 + 3 + 4) becomes REC_MAX_N_FIELDS -- not allowed
--error ER_INNODB_INSTANT_ADD_NOT_SUPPORTED_MAX_FIELDS
ALTER TABLE tb1 ADD COLUMN col_1016 INT, ALGORITHM=INSTANT;

--echo # Step 3. Verify that ADD is possible without specifying ALGORITHM (should fallback to INPLACE)
ALTER TABLE tb1 ADD COLUMN col_last INT;
--echo # Table is rebuilt when ALGORITHM=INPLACE is used (internally)
--echo # Current: n_def = 1017 (1017)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/tb1";

--echo # Cleanup
DROP TABLE tb1;

--echo ########################################
--echo # Scenario 2: ADD/DROP two columns:
--echo ########################################
--echo # REC_MAX_N_FIELDS = 1023 -- max number of fields allowed.
--echo # Step 1. DROP - ADD columns until (n_def + <col_added> < REC_MAX_N_FIELDS)

--echo # Current: n_def = 1020 (<user> + 3(DB_ROW_ID + DB_TRX_ID + DB_ROLL_PTR) + <drop_cols>)
--echo # Current: n_def = 1020 (1017 + 3 + 0)

ALTER TABLE t1 DROP COLUMN col_last, DROP COLUMN col_1016, ALGORITHM=INSTANT;
--echo # Current: n_def = 1020 (1015 + 3 + 2)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t1";

ALTER TABLE t1 ADD COLUMN col_last INT, ADD COLUMN col_1016 INT, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1017 + 3 + 2)

ALTER TABLE t1 DROP COLUMN col_last, DROP COLUMN col_1016, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1015 + 3 + 4)

--echo # Step 2. Test that ADD with ALGORITHM=INSTANT is no longer allowed:
--echo # Current: n_def = 1022 (1015 + 3 + 4)
--echo # If we ADD 2 columns: n_def = 1024 (1017 + 3 + 4) becomes > REC_MAX_N_FIELDS -- not allowed
--error ER_INNODB_INSTANT_ADD_NOT_SUPPORTED_MAX_FIELDS
ALTER TABLE t1 ADD COLUMN col_last INT, ADD COLUMN col_1016 INT, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1015 + 3 + 4)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t1";

--echo # If we ADD 1 column: n_def = 1023 (1016 + 3 + 4) becomes REC_MAX_N_FIELDS -- not allowed
--error ER_INNODB_INSTANT_ADD_NOT_SUPPORTED_MAX_FIELDS
ALTER TABLE t1 ADD COLUMN col_last INT, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1015 + 3 + 4)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t1";

--echo # Note that we can still DROP columns with INSTANT:
ALTER TABLE t1 DROP COLUMN col_1015, DROP COLUMN col_1014, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1013 + 3 + 6)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t1";

--echo # But we cannot ADD any more columns with INSTANT:
--echo # If we ADD 1 column: n_def = 1023 (1014 + 3 + 6) becomes REC_MAX_N_FIELDS -- not allowed
--error ER_INNODB_INSTANT_ADD_NOT_SUPPORTED_MAX_FIELDS
ALTER TABLE t1 ADD COLUMN col_1015 INT, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1013 + 3 + 6)

--echo # Step 3. Verify that ADD is possible without specifying ALGORITHM (should fallback to INPLACE)
ALTER TABLE t1 ADD COLUMN col_1014 INT, ADD COLUMN col_1015 INT, ADD COLUMN col_1016 INT, ADD COLUMN col_last INT;
--echo # Table is rebuilt when ALGORITHM=INPLACE is used (internally)
--echo # Current: n_def = 1017 (1017)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t1";

--echo # Cleanup
DROP TABLE t1;

--echo ########################################
--echo # Scenario 3: ADD/DROP multiple columns:
--echo ########################################
--echo # REC_MAX_N_FIELDS = 1023 -- max number of fields allowed.
--echo # ADD/DROP multiple columns and look for failures

--echo # Current: n_def = 1020 (<user> + 3(DB_ROW_ID + DB_TRX_ID + DB_ROLL_PTR) + <drop_cols>)
--echo # Current: n_def = 1020 (1017 + 3 + 0)
ALTER TABLE t2 DROP COLUMN col_1016, DROP COLUMN col_1015, DROP COLUMN col_1014, DROP COLUMN col_1013, DROP COLUMN col_1012, DROP COLUMN col_1011, ALGORITHM=INSTANT;
--echo # Current: n_def = 1020 (1011 + 3 + 6)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t2";

--error ER_INNODB_INSTANT_ADD_NOT_SUPPORTED_MAX_FIELDS
ALTER TABLE t2 ADD COLUMN col_1011 INT, DROP COLUMN col_1010, ADD COLUMN col_1012 INT, ADD COLUMN col_1013 INT, DROP COLUMN col_1009, DROP COLUMN col_1008, ADD COLUMN col_1014 INT, ALGORITHM=INSTANT;
--echo # If operation was successful: n_def = 1027 (1015 + 3 + 9) > REC_MAX_N_FIELDS
--echo # Current: n_def = 1020 (1011 + 3 + 6)

ALTER TABLE t2 ADD COLUMN col_1015 INT, ADD COLUMN col_1016 INT, DROP COLUMN col_1010, ALGORITHM=INSTANT;
--echo # Current: n_def = 1022 (1012 + 3 + 7)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t2";

--echo # Fallback to inplace for failed query
ALTER TABLE t2 ADD COLUMN col_1011 INT, DROP COLUMN col_1007, ADD COLUMN col_1012 INT, ADD COLUMN col_1013 INT, DROP COLUMN col_1009, DROP COLUMN col_1008, ADD COLUMN col_1014 INT;
--echo # Current: n_def = 1017 (1017)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t2";

--echo # Cleanup
DROP TABLE t2;

--echo ########################################
--echo # Scenario 4: With other ALTER operations:
--echo ########################################
--echo # REC_MAX_N_FIELDS = 1023 -- max number of fields allowed.
--echo # ADD/DROP with other ALTER operations

--echo # Current: n_def = 1020 (<user> + 3(DB_ROW_ID + DB_TRX_ID + DB_ROLL_PTR) + <drop_cols>)
--echo # Current: n_def = 1020 (1017 + 3 + 0)
ALTER TABLE t3 DROP COLUMN col_1016, DROP COLUMN col_1015, DROP COLUMN col_1014, DROP COLUMN col_1013, DROP COLUMN col_1012, DROP COLUMN col_1011, DROP COLUMN col_1010, DROP COLUMN col_1009, ALGORITHM=INSTANT;
--echo Current: n_def = 1020 (1009 + 3 + 8)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t3";

ALTER TABLE t3 ADD COLUMN col_1009 INT, RENAME COLUMN col_last TO col_1017, RENAME COLUMN col_1007 TO col_1007_new, ADD COLUMN col_1011 INT, DROP COLUMN col_1008, ALGORITHM=INSTANT;
--echo Current: n_def = 1022 (1010 + 3 + 9)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t3";

--error ER_INNODB_INSTANT_ADD_NOT_SUPPORTED_MAX_FIELDS
ALTER TABLE t3 ADD COLUMN col_1010 INT, ALGORITHM=INSTANT;
--echo Current: n_def = 1022 (1010 + 3 + 9)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t3";

--echo Similarly single column add/drop will fail
--error ER_INNODB_INSTANT_ADD_NOT_SUPPORTED_MAX_FIELDS
ALTER TABLE t3 ADD COLUMN col_1010 INT, DROP COLUMN col_1009, ALGORITHM=INSTANT;
--echo Current: n_def = 1022 (1010 + 3 + 9)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t3";
--echo Fallback to inplace for failed query


ALTER TABLE t3 ADD COLUMN col_1010 INT;
--echo Current: n_def = 1017 (1017)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t3";

--echo # Cleanup
DROP TABLE t3;

--echo ########################################
--echo # Scenario 5: ADD/DROP few columns:
--echo ########################################
--echo # REC_MAX_N_FIELDS = 1023 -- max number of fields allowed.
--echo # ADD/DROP few columns together

--echo # Current: n_def = 1020 (<user> + 3(DB_ROW_ID + DB_TRX_ID + DB_ROLL_PTR) + <drop_cols>)
--echo # Current: n_def = 1020 (1017 + 3 + 0)
ALTER TABLE t4 DROP COLUMN col_1016, DROP COLUMN col_1015, DROP COLUMN col_1014, DROP COLUMN col_1013, DROP COLUMN col_1012, DROP COLUMN col_1011, DROP COLUMN col_1010, DROP COLUMN col_1009, ALGORITHM=INSTANT;
--echo Current: n_def = 1020 (1009 + 3 + 8)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t4";

ALTER TABLE t4 ADD COLUMN col_1016 INT, DROP COLUMN col_1008, ALGORITHM=INSTANT;
--echo Current: n_def = 1021 (1009 + 3 + 9)

ALTER TABLE t4 ADD COLUMN col_1015 INT, DROP COLUMN col_1007, DROP COLUMN col_1006, ALGORITHM=INSTANT;
--echo Current: n_def = 1022 (1008 + 3 + 11)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t4";

--error ER_INNODB_INSTANT_ADD_NOT_SUPPORTED_MAX_FIELDS
ALTER TABLE t4 ADD COLUMN col_1014 INT, ADD COLUMN col_1013 INT, DROP COLUMN col_1005, ALGORITHM=INSTANT;
--echo Current: n_def = 1022 (1008 + 3 + 11)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t4";

--echo Fallback to inplace for failed query
ALTER TABLE t4 ADD COLUMN col_1014 INT, ADD COLUMN col_1013 INT, DROP COLUMN col_1005;
--echo Current: n_def = 1009 (1008 <prev without dropped> + 2 - 1 <add/drop in current>)
SELECT TOTAL_ROW_VERSIONS, N_COLS, CURRENT_COLUMN_COUNTS, INITIAL_COLUMN_COUNTS, TOTAL_COLUMN_COUNTS FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME="test/t4";

--echo # Cleanup
DROP TABLE t4;
