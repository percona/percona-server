--source include/have_partition.inc
--source include/count_sessions.inc

eval CREATE TABLE `t1` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `k` int(11) NOT NULL DEFAULT '0',
  `c` char(120) NOT NULL DEFAULT '',
  `pad` char(60) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`),
  KEY `k_1` (`k`)
) ENGINE=$engine AUTO_INCREMENT=10001 DEFAULT CHARSET=utf8mb4
PARTITION BY RANGE (`id`)
SUBPARTITION BY HASH (`id`)
SUBPARTITIONS 20
(PARTITION p0 VALUES LESS THAN (333333),
 PARTITION p1 VALUES LESS THAN (666666),
 PARTITION p3 VALUES LESS THAN MAXVALUE);

INSERT INTO t1 VALUES (20,5011,'82095294113-46718689069-93751429117-94982456004-28879831505-39496075815-87005112245-60372548581-07992589471-35458088958','78183819052-54767035794-64034000286-75682734084-27025271045'),(40,5037,'96458712584-04274358647-34600172982-61258877004-02456216612-93017353068-68948947187-65320412979-86812414667-04055433428','95674959566-59630142193-63453128243-68849021141-08672523473'),(60,3761,'51940584032-40151584646-01263150854-80980948000-73690232712-88605487014-13973299616-30051733966-92938202491-23238143422','35056562675-38773091386-28325876611-93328856424-07318410640'),(80,5030,'97366695989-67793472372-01073016448-88420943430-06742885226-53625048051-49633140042-38845136504-58561938096-76961679381','51626628663-10353574199-64993757935-88432770455-20027636424'),(100,4996,'45575584051-98066223638-50505155169-83257674849-92578957352-29933207560-84271372173-53917929075-64247206072-28852761782','69156787560-46290357747-57606466747-21639043920-96331231238'),(120,5073,'55169033460-32678558171-43672981950-72378152482-84693479612-76708194965-33191893015-16735847859-84813156526-50930934949','32512962596-41287818775-90537814331-28667161937-98732853550');

--let $i = 1
while ($i <= 10) {
 --connect (con$i, localhost, root)
 --inc $i
}

--let $i = 1
while ($i <= 10) {
 --connection con$i
 --send_eval SELECT c FROM t1 WHERE id = $i * 20 % 120
 --inc $i
}

--let $i = 1
while ($i <= 10) {
 --connection con$i
 --reap
 --inc $i
}

connection default;

--let $i = 1
while ($i <= 10) {
 --disconnect con$i
 --inc $i
}

DROP TABLE t1;
--source include/wait_until_count_sessions.inc
