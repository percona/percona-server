#
# Test for https://bugs.launchpad.net/percona-server/+bug/1380010: in RBR,
# if there is a virtual temporary table for row conversion present, a Table_map
# event followed by two row events will crash the server.
#
# The current server does not produce such binlog. The statements below were
# produced by running, on 5.5.36-34.0:
# insert into ttt(c1) values (1000*rand()), (1000*rand()), (1000*rand()), (1000*rand());
# insert into ttt(c1) select 1000*rand() from ttt t1, ttt t2, ttt t3;
# 
CREATE TABLE ttt(c1 CHAR(250), c2 TIME NOT NULL) ENGINE=InnoDB CHARACTER SET=latin1;

BINLOG '
VydmVA8BAAAAZwAAAGsAAAAAAAQANS41LjM2LTM0LjAtZGVidWctbG9nAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAABXJ2ZUEzgNAAgAEgAEBAQEEgAAVAAEGggAAAAICAgCAA==
';

BEGIN;

# at 600
#141114 18:01:27 server id 1  end_log_pos 645 	Table_map: `test`.`ttt` mapped to number 41
# at 645
#141114 18:01:27 server id 1  end_log_pos 1670 	Write_rows: table id 41
# at 1670
#141114 18:01:27 server id 1  end_log_pos 2122 	Write_rows: table id 41 flags: STMT_END_F

BINLOG '
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
';
COMMIT;

SELECT COUNT(*) FROM ttt;

DROP TABLE ttt;
