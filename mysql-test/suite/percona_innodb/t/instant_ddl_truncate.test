##########################################################################
# 107613 - Assertion failure: dict0dd.cc:1685:dd_column_is_dropped(old_col)
##########################################################################

# Test 1 - Normal Tables

CREATE TABLE tb1 (
col1 INT,
col2 INT
) ENGINE=InnoDB ;
ALTER TABLE tb1 DROP COLUMN col2, ALGORITHM=INSTANT;
TRUNCATE TABLE tb1 ;
ALTER TABLE tb1 ADD COLUMN col2 INT, ALGORITHM=INSTANT;
DROP TABLE tb1;
CREATE TABLE tb1 (
col1 INT,
col2 INT,
col3 INT
) ENGINE=InnoDB ;
ALTER TABLE tb1 DROP COLUMN col2, ALGORITHM=INSTANT;
TRUNCATE TABLE tb1 ;
ALTER TABLE tb1 DROP COLUMN col3, ALGORITHM=INSTANT;

# Test 2 - Partitioned Tables

CREATE TABLE tb1_part (
    col1 INT NOT NULL,
    col2 INT NOT NULL,
    col3 INT NOT NULL,
    col4 INT,
    col5 DATE NOT NULL
)
PARTITION BY RANGE( YEAR(col5) ) (
    PARTITION p0 VALUES LESS THAN (2018),
    PARTITION p1 VALUES LESS THAN (2019),
    PARTITION p2 VALUES LESS THAN (2020),
    PARTITION p3 VALUES LESS THAN (2021),
    PARTITION p4 VALUES LESS THAN MAXVALUE
);
ALTER TABLE tb1_part DROP COLUMN col2, ALGORITHM=INSTANT;
INSERT INTO tb1_part VALUES (1,3,4, '2017-01-01');
INSERT INTO tb1_part VALUES (1,3,4, '2018-01-01');
INSERT INTO tb1_part VALUES (1,3,4, '2019-01-01');
INSERT INTO tb1_part VALUES (1,3,4, '2020-01-01');
INSERT INTO tb1_part VALUES (1,3,4, '2021-01-01');
INSERT INTO tb1_part VALUES (1,3,4, '2022-01-01');
SELECT * FROM tb1_part PARTITION (p1);
ALTER TABLE tb1_part DROP COLUMN col3, ALGORITHM=INSTANT;
ALTER TABLE tb1_part TRUNCATE PARTITION p1;
ALTER TABLE tb1_part ADD COLUMN col2 INT, ALGORITHM=INSTANT;
SELECT * FROM tb1_part;
TRUNCATE TABLE tb1_part ;
ALTER TABLE tb1_part ADD COLUMN col6 INT, ALGORITHM=INSTANT;
# clean-up
DROP TABLE tb1, tb1_part;

