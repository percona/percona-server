--source include/have_rocksdb.inc

# Test insert ... on duplicate key update statements

CREATE TABLE t1 (id1 INT, id2 INT, id3 INT,
                 PRIMARY KEY (id1, id2, id3),
                 UNIQUE KEY (id3, id1)) ENGINE=ROCKSDB;

CREATE TABLE t2 (id1 INT, id2 INT, id3 INT,
                 PRIMARY KEY (id1, id2, id3),
                 UNIQUE KEY (id3, id1) COMMENT 'cfname=rev:cf') ENGINE=ROCKSDB;


--source suite/rocksdb/include/dup_key_update.inc

# Cleanup
DROP TABLE t1;
DROP TABLE t2;

set @orig_rocksdb_large_prefix=@@global.rocksdb_large_prefix;
set @@global.rocksdb_large_prefix=1;
CREATE TABLE t1 (id1 varchar(128) CHARACTER SET latin1 COLLATE latin1_bin,
                 id2 varchar(256) CHARACTER SET utf8mb3 COLLATE utf8mb3_bin,
                 id3 varchar(200) CHARACTER SET latin1 COLLATE latin1_swedish_ci,
                 PRIMARY KEY (id1, id2, id3),
                 UNIQUE KEY (id3, id1)) ENGINE=ROCKSDB;

CREATE TABLE t2 (id1 varchar(128) CHARACTER SET latin1 COLLATE latin1_bin,
                 id2 varchar(256) CHARACTER SET utf8mb3 COLLATE utf8mb3_bin,
                 id3 varchar(200) CHARACTER SET latin1 COLLATE latin1_swedish_ci,
                 PRIMARY KEY (id1, id2, id3),
                 UNIQUE KEY (id3, id1) COMMENT 'cfname=rev:cf') ENGINE=ROCKSDB;
set @@global.rocksdb_large_prefix=@orig_rocksdb_large_prefix;

--source suite/rocksdb/include/dup_key_update.inc

# Cleanup
DROP TABLE t1;
DROP TABLE t2;

set @orig_rocksdb_xlarge_prefix=@@global.rocksdb_xlarge_prefix;
set @@global.rocksdb_xlarge_prefix=1;
CREATE TABLE t1 (id1 varchar(2048) CHARACTER SET latin1 COLLATE latin1_bin,
                 id2 varchar(2048) CHARACTER SET utf8mb3 COLLATE utf8mb3_bin,
                 id3 varchar(2048) CHARACTER SET latin1 COLLATE latin1_swedish_ci,
                 PRIMARY KEY (id1, id2, id3),
                 UNIQUE KEY (id3, id1)) ENGINE=ROCKSDB;

CREATE TABLE t2 (id1 varchar(2048) CHARACTER SET latin1 COLLATE latin1_bin,
                 id2 varchar(2048) CHARACTER SET utf8mb3 COLLATE utf8mb3_bin,
                 id3 varchar(2048) CHARACTER SET latin1 COLLATE latin1_swedish_ci,
                 PRIMARY KEY (id1, id2, id3),
                 UNIQUE KEY (id3, id1) COMMENT 'cfname=rev:cf') ENGINE=ROCKSDB;
set @@global.rocksdb_xlarge_prefix=@orig_rocksdb_xlarge_prefix;

--source suite/rocksdb/include/dup_key_update.inc

# Cleanup
DROP TABLE t1;
DROP TABLE t2;
