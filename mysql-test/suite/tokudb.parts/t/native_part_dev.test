--echo # This test is for debugging
--exit
--source include/have_partition.inc
--source include/have_tokudb.inc

--let $MYSQLD_DATADIR=`select @@datadir`

CREATE TABLE `t1` (
  `f_int1` int(11) DEFAULT NULL,
  `f_int2` int(11) DEFAULT NULL,
  `f_char1` char(20) DEFAULT NULL,
  `f_char2` char(20) DEFAULT NULL,
  `f_charbig` varchar(1000) DEFAULT NULL
) ENGINE=TokuDB
PARTITION BY RANGE (f_int1 DIV 2)
SUBPARTITION BY HASH (f_int1)
SUBPARTITIONS 2
(PARTITION parta VALUES LESS THAN (0) ENGINE = TokuDB,
 PARTITION partb VALUES LESS THAN (5) ENGINE = TokuDB,
 PARTITION partc VALUES LESS THAN (10) ENGINE = TokuDB,
 PARTITION partd VALUES LESS THAN (2147483646) ENGINE = TokuDB);

--list_files $MYSQLD_DATADIR/test *
DROP TABLE t1;


CREATE TABLE t1 (
f_int1 INTEGER,
f_int2 INTEGER
) ENGINE=TokuDB
PARTITION BY HASH(f_int1 + f_int2) PARTITIONS 2;

ALTER TABLE t1 ADD PRIMARY KEY(f_int1,f_int2);

DROP TABLE t1;



CREATE TABLE t1 (a INT PRIMARY KEY) ENGINE=TokuDB
PARTITION BY RANGE (a)
SUBPARTITION BY HASH (A)
SUBPARTITIONS 2 (
  PARTITION p0 VALUES LESS THAN (300),
  PARTITION p1 VALUES LESS THAN (500)
);

insert into t1 set a = 250;
insert into t1 set a = 255;
insert into t1 set a = 350;
insert into t1 set a = 355;
insert into t1 set a = 50;
insert into t1 set a = 55;

select * from t1;

select * from t1 where a = 355;

update t1 set a = 10 where a = 355;
select * from t1;

update t1 set a = a + 1;
select * from t1;

DROP TABLE t1;

create table t1 (a int unsigned not null, primary key(a)) engine=tokudb
PARTITION BY RANGE (a) (
    PARTITION p0 VALUES LESS THAN (100),
    PARTITION p1 VALUES LESS THAN (200),
    PARTITION p2 VALUES LESS THAN (300),
    PARTITION p3 VALUES LESS THAN (400)
);

--list_files $MYSQLD_DATADIR/test *

insert into t1 set a = 250;
insert into t1 set a = 255;
insert into t1 set a = 350;
insert into t1 set a = 355;
insert into t1 set a = 50;
insert into t1 set a = 55;

select * from t1;

select * from t1 where a = 355;

update t1 set a = 10 where a = 355;
select * from t1;

update t1 set a = a + 1;
select * from t1;

rename table t1 to t2;
--list_files $MYSQLD_DATADIR/test *
select * from t2;

ALTER TABLE t2 RENAME t1;

--list_files $MYSQLD_DATADIR/test *
select * from t1;

ALTER TABLE t1 ADD COLUMN b INT UNSIGNED;
SHOW CREATE TABLE t1;

ALTER TABLE t1 ADD PARTITION (PARTITION p4 VALUES LESS THAN (500));
insert into t1 set a = 450;
insert into t1 set a = 390;
SHOW CREATE TABLE t1;
select * from t1;
--list_files $MYSQLD_DATADIR/test *

ALTER TABLE t1 DROP PARTITION p4;
SHOW CREATE TABLE t1;
select * from t1;
--list_files $MYSQLD_DATADIR/test *

drop table t1;
--list_files $MYSQLD_DATADIR/test *
