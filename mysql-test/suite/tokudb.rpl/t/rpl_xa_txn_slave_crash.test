--source include/have_tokudb.inc
--source include/not_group_replication_plugin.inc
--source include/have_binlog_format_mixed_or_row.inc
--source include/master-slave.inc


eval CREATE TABLE t1(`a` INT) ENGINE=TokuDB;

connection master;
xa start 'x1';
insert into t1 values (1);
xa end 'x1';
xa prepare 'x1';
xa commit 'x1';

xa start 'x2';
insert into t1 values (2);
xa end 'x2';
xa prepare 'x2';
xa commit 'x2';

xa start 'x3';
insert into t1 values (3);
xa end 'x3';
xa prepare 'x3';
xa rollback 'x3';

begin;
insert into t1 values (2);
commit;

begin;
insert into t1 values (3);
rollback;

sync_slave_with_master;

--echo TABLES t1 and t2 must be equal otherwise an error will be thrown.
let $diff_tables= master:test.t1, slave:test.t1;
source include/diff_tables.inc;

connection master;
drop table t1;
--source include/rpl_end.inc
