# test for PS-7076 : Cardinality is equal for all indexes when last partition empty

source include/have_tokudb.inc;

CREATE TABLE t1 (
 id int NOT NULL AUTO_INCREMENT,
 a int DEFAULT NULL,
 b int DEFAULT NULL,
 c varchar(10) DEFAULT NULL,
 d date NOT NULL,
 PRIMARY KEY (id,d),
 KEY a (a),
 KEY b (b),
 KEY c (c)
) ENGINE=TokuDB DEFAULT CHARSET=latin1
 PARTITION BY RANGE (to_days(d))
(PARTITION p20200427 VALUES LESS THAN (737908) ENGINE = TokuDB,
 PARTITION p20200428 VALUES LESS THAN (737909) ENGINE = TokuDB,
 PARTITION p20200429 VALUES LESS THAN (737910) ENGINE = TokuDB);

SET tokudb_analyze_in_background=0;
set tokudb_analyze_time=0;
INSERT INTO t1 VALUES(NULL, RAND()*1000, RAND()*10000, "hello", "2020-04-28");
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
INSERT INTO t1 SELECT NULL, RAND()*1000, RAND()*10000, c, d FROM t1;
ANALYZE TABLE t1;
SHOW INDEXES FROM t1;
DROP TABLE t1;
