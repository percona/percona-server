# ----------------------------------------------------------------------
# Setup
# Creating local configuration file for keyring component: component_keyring_file
# Creating manifest file for current MySQL server instance
# Re-starting mysql server with manifest file
# ----------------------------------------------------------------------
#
# Get current password
SELECT audit_log_encryption_password_get();
audit_log_encryption_password_get()
<password>
#
# Check passwords sequence
SET GLOBAL DEBUG='+d,audit_log_filter_debug_timestamp';
SELECT audit_log_encryption_password_set('pwd1');
audit_log_encryption_password_set('pwd1')
OK
SELECT audit_log_encryption_password_set('pwd2');
audit_log_encryption_password_set('pwd2')
OK
SELECT audit_log_encryption_password_set('pwd3');
audit_log_encryption_password_set('pwd3')
OK
CREATE TABLE tmp(id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
key_id VARCHAR(1024));
INSERT INTO tmp (key_id)
SELECT KEY_ID FROM performance_schema.keyring_keys
WHERE KEY_ID LIKE 'audit_log%' ORDER BY KEY_ID DESC;
SELECT audit_log_encryption_password_get('audit_log-20220810T100000-1');
audit_log_encryption_password_get('audit_log-20220810T100000-1')
pwd1
SELECT audit_log_encryption_password_get('audit_log-20220811T100000-1');
audit_log_encryption_password_get('audit_log-20220811T100000-1')
pwd2
SELECT audit_log_encryption_password_get('audit_log-20220812T100000-1');
audit_log_encryption_password_get('audit_log-20220812T100000-1')
pwd3
# ----------------------------------------------------------------------
# Teardown
# Removing manifest file for current MySQL server instance
# Removing local keyring file for keyring component: component_keyring_file
# Removing local configuration file for keyring component: component_keyring_file
# Restarting server without the manifest file
# ----------------------------------------------------------------------
#
# Cleanup
SET GLOBAL DEBUG='-d,audit_log_filter_debug_timestamp';
DROP TABLE tmp;
